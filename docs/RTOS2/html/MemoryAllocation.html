<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Memory Allocation</title>
<title>CMSIS-RTOS2: Memory Allocation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="cmsis.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="CMSIS_Logo_Final.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CMSIS-RTOS2
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
   <div id="projectbrief">Real-Time Operating System: API and RTX Reference Implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('MemoryAllocation.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Memory Allocation </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The RTX objects (thread, mutex, semaphore, timer, message, event and memory pool) require dedicated RAM memory. Objects can be created using os<em>object</em>New() calls and deleted using os<em>object</em>Delete() calls. The related object memory needs to be available during the life-time of the object.</p>
<p>RTX5 offers three different memory allocation methods for objects:</p>
<ul>
<li><a class="el" href="MemoryAllocation.html#GlobalMemoryPool">Global Memory Pool</a> uses a single global memory pool for all objects. It is easy to configure, but may have the disadvantage for memory fragmentation when objects with different sizes are created and destroyed.</li>
<li><a class="el" href="MemoryAllocation.html#ObjectMemoryPool">Object-specific Memory Pools</a> uses a fixed-size memory pool for each object type. The method is time deterministic and avoids memory fragmentation.</li>
<li><a class="el" href="MemoryAllocation.html#StaticObjectMemory">Static Object Memory</a> reserves memory during compile time and completely avoids that a system can be out of memory. This is typically a required for some safety critical systems.</li>
</ul>
<p>It possible to intermix all the memory allocation methods in the same application.</p>
<h1><a class="anchor" id="GlobalMemoryPool"></a>
Global Memory Pool</h1>
<p>The global memory pool allocates all objects from a one memory area. This method of memory allocation is the default configuration setting of RTX5.</p>
<div class="image">
<img src="MemAllocGlob.png" alt="MemAllocGlob.png"/>
<div class="caption">
Global Memory Pool for all objects</div></div>
<p> When pool does not provide sufficient memory the creation of the object fails and the related os<em>object</em>New() function returns <span class="XML-Token">NULL</span>.</p>
<p>Enabled in <a class="el" href="systemConfig.html">System Configuration</a>.</p>
<h1><a class="anchor" id="ObjectMemoryPool"></a>
Object-specific Memory Pools</h1>
<p>Object-specific Memory Pools avoids memory fragmentation with a dedicated fixed-size memory management for each object type. This type of memory pools are fully time deterministic, which means object creation and destruction takes always the same fixed amount of time. As a fixed-size memory pool is specific to an object type the handling of out-of-memory situations is simplified.</p>
<div class="image">
<img src="MemAllocSpec.png" alt="MemAllocSpec.png"/>
<div class="caption">
One memory pool per object type</div></div>
<p> Object-specific memory pools are selectively enabled for each object type, e.g: mutex or thread using the RTX configuration file:</p>
<ul>
<li>Enabled in <a class="el" href="threadConfig.html">Thread Configuration</a> for thread objects.</li>
<li>Enabled in <a class="el" href="timerConfig.html">Timer Configuration</a> for timer objects.</li>
<li>Enabled in <a class="el" href="eventFlagsConfig.html">Event Flags Configuration</a> for event objects.</li>
<li>Enabled in <a class="el" href="mutexConfig.html">Mutex Configuration</a> for mutex objects.</li>
<li>Enabled in <a class="el" href="semaphoreConfig.html">Semaphore Configuration</a> for semaphore.</li>
<li>Enabled in <a class="el" href="memPoolConfig.html">Memory Pool Configuration</a> for memory pools.</li>
<li>Enabled in <a class="el" href="msgQueueConfig.html">Message Queue Configuration</a> for message objects.</li>
</ul>
<p>When memory pool does not provide sufficient memory the creation of the object fails and the related os<em>object</em>New() function returns <span class="XML-Token">NULL</span>.</p>
<h1><a class="anchor" id="StaticObjectMemory"></a>
Static Object Memory</h1>
<p>In contrast to the dynamic memory allocations the static memory allocation requires compile-time allocation of object memory.</p>
<div class="image">
<img src="MemAllocStat.png" alt="MemAllocStat.png"/>
<div class="caption">
Statically allocated memory for all objects</div></div>
<p> The following code example shows how to create an OS object using static memory.</p>
<p><b> Code Example: </b> </p>
<div class="fragment"><div class="line"><span class="comment">/*----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * CMSIS-RTOS &#39;main&#39; function template</span></div>
<div class="line"><span class="comment"> *---------------------------------------------------------------------------*/</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &quot;RTE_Components.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include  CMSIS_device_header</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="cmsis__os2_8h.html">cmsis_os2.h</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//include rtx_os.h for types of RTX objects</span></div>
<div class="line"><span class="preprocessor">#include &quot;rtx_os.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">//The thread function instanced in this example</span></div>
<div class="line"><span class="keywordtype">void</span> worker(<span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">while</span>(1) </div>
<div class="line">  {</div>
<div class="line">    <span class="comment">//work</span></div>
<div class="line">        <a class="code" href="group__CMSIS__RTOS__Wait.html#gaf6055a51390ef65b6b6edc28bf47322e">osDelay</a>(10000);</div>
<div class="line">  }  </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define objects that are statically allocated for worker threads 1 and 2</span></div>
<div class="line">os_thread_t worker_thread_tcb_1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Reserve two areas for the stacks of worker threads 1 and 2</span></div>
<div class="line"><span class="comment">// uint64_t makes sure the memory alignment is 8</span></div>
<div class="line">uint64_t worker_thread_stk_1[64];</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Define the attributes which are used for thread creation</span></div>
<div class="line"><span class="comment">// Optional const saves RAM memory and includes the values in periodic ROM tests </span></div>
<div class="line"><span class="keyword">const</span> <a class="code" href="group__CMSIS__RTOS__ThreadMgmt.html#structosThreadAttr__t">osThreadAttr_t</a> worker_attr_1 = { </div>
<div class="line">        <span class="stringliteral">&quot;wrk1&quot;</span>, </div>
<div class="line">        <a class="code" href="group__CMSIS__RTOS__ThreadMgmt.html#ga249499c519f3f8eef5673009ab6cfcbe">osThreadJoinable</a>, </div>
<div class="line">        &amp;worker_thread_tcb_1, </div>
<div class="line">        <span class="keyword">sizeof</span>(worker_thread_tcb_1),</div>
<div class="line">        &amp;worker_thread_stk_1[0],  </div>
<div class="line">        <span class="keyword">sizeof</span>(worker_thread_stk_1),</div>
<div class="line">        <a class="code" href="cmsis__os2_8h.html#gad4e3e0971b41f2d17584a8c6837342eca17b36cd9cd38652c2bc6d4803990674b">osPriorityAboveNormal</a>,</div>
<div class="line">        0</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"></div>
<div class="line"><span class="comment">// Define ID object for thread</span></div>
<div class="line"><a class="code" href="group__CMSIS__RTOS__ThreadMgmt.html#gaa6c32fe2a3e0a2e01f212d55b02e51c7">osThreadId_t</a> th1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> * Application main thread</span></div>
<div class="line"><span class="comment"> *---------------------------------------------------------------------------*/</span></div>
<div class="line"><span class="keywordtype">void</span> app_main (<span class="keywordtype">void</span> *argument) {</div>
<div class="line">  uint32_t param = NULL;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Create an instance of the worker thread with static resources (TCB and stack)</span></div>
<div class="line">  th1 = <a class="code" href="group__CMSIS__RTOS__ThreadMgmt.html#ga8c59d9c5fcd0d286ad2a0f24dead8e6a">osThreadNew</a>(worker, &amp;param, &amp;worker_attr_1);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (;;) {}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main (<span class="keywordtype">void</span>) {</div>
<div class="line">  <span class="comment">// System Initialization</span></div>
<div class="line">  SystemCoreClockUpdate();</div>
<div class="line">  <span class="comment">// ...</span></div>
<div class="line"></div>
<div class="line">  <a class="code" href="group__CMSIS__RTOS__KernelCtrl.html#gae818f6611d25ba3140bede410a52d659">osKernelInitialize</a>();                 <span class="comment">// Initialize CMSIS-RTOS</span></div>
<div class="line">  <a class="code" href="group__CMSIS__RTOS__ThreadMgmt.html#ga8c59d9c5fcd0d286ad2a0f24dead8e6a">osThreadNew</a>(app_main, NULL, NULL);    <span class="comment">// Create application main thread</span></div>
<div class="line">  <a class="code" href="group__CMSIS__RTOS__KernelCtrl.html#ga9ae2cc00f0d89d7b6a307bba942b5221">osKernelStart</a>();                      <span class="comment">// Start thread execution</span></div>
<div class="line">  <span class="keywordflow">for</span> (;;) {}</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="rtx5_impl.html">RTX v5 Implementation</a></li>
    <li class="footer">Generated on Fri Nov 11 2016 12:41:45 for CMSIS-RTOS2 by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
