<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Thread Configuration</title>
<title>CMSIS-RTOS2: Thread Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="cmsis.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="printComponentTabs.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 46px;">
  <td id="projectlogo"><img alt="Logo" src="CMSIS_Logo_Final.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">CMSIS-RTOS2
   &#160;<span id="projectnumber">Version 2.0.0</span>
   </div>
   <div id="projectbrief">Real-Time Operating System: API and RTX Reference Implementation</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<div id="CMSISnav" class="tabs1">
    <ul class="tablist">
      <script type="text/javascript">
		<!--
		writeComponentTabs.call(this);
		//-->
      </script>
	  </ul>
</div>
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Usage&#160;and&#160;Description</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('threadConfig.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Thread Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The CMSIS-RTOS RTX provides several parameters to configure the <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html">Thread Management</a> functions.</p>
<h1>Configuration of Thread Count and Stack Space </h1>
<p>The CMSIS-RTOS RTX kernel uses a separate stack space for each thread and provides two methods for defining the stack requirements:</p>
<ul>
<li><b>Static allocation</b>: when <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#ad7c9b42355a4c8b9467130ab3fb19e43">osThreadAttr_t::stack_mem</a> and <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#aacbc9a219f2d6870e9ce89bb93f975c9">osThreadAttr_t::stack_size</a> specify a memory area which is used for the thread stack.</li>
<li><b>Dynamic allocation</b>: when <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#structosThreadAttr__t">osThreadAttr_t</a> is NULL or <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#ad7c9b42355a4c8b9467130ab3fb19e43">osThreadAttr_t::stack_mem</a> is NULL, the system allocates the stack memory from:<ul>
<li><a class="el" href="MemoryAllocation.html#GlobalMemoryPool">Global Memory Pool</a> when “Object specific Memory allocation” is disabled or <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#aacbc9a219f2d6870e9ce89bb93f975c9">osThreadAttr_t::stack_size</a> is not 0.</li>
<li><a class="el" href="MemoryAllocation.html#ObjectMemoryPool">Object-specific Memory Pools</a> when “Object specific Memory allocation” is enabled and <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#aacbc9a219f2d6870e9ce89bb93f975c9">osThreadAttr_t::stack_size</a> is 0 (or <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#structosThreadAttr__t">osThreadAttr_t</a> is NULL).</li>
</ul>
</li>
</ul>
<p><a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#structosThreadAttr__t">osThreadAttr_t</a> is a parameter of the function <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#ga8c59d9c5fcd0d286ad2a0f24dead8e6a">osThreadNew</a>.</p>
<dl class="section note"><dt>Note</dt><dd>Before the RTX kernel is started by the <a class="el" href="group__CMSIS__RTOS__KernelCtrl.html#gae818f6611d25ba3140bede410a52d659">osKernelInitialize()</a> function, the main stack defined in startup_<em>device</em>.s is used. The main stack is also used for:<ul>
<li>user application calls to RTX functions in Thread mode using SVC calls</li>
<li>interrupt/exception handlers.</li>
</ul>
</dd></dl>
<h1>Stack Overflow Checking </h1>
<p>RTX5 implements a software stack overflow checking that traps stack overruns. Stack is used for return addresses and automatic variables and extensive usage or incorrect stack configuration may cause a stack overflow. Software stack overflow checking is controlled with the define <code>OS_STACK_CHECK</code>.</p>
<p>If a stack overflow is detected, the function <b>os_Error</b> with error code <b>os_ErrorStackUnderflow</b> is called. By default, this function is implemented as endless loop and will practically stop code execution.</p>
<h1>Stack Usage Watermark </h1>
<p>RTX5 initializes thread stack with watermark pattern (0xCC) when a thread is created. This allows the debugger to determine maximum stack usage for each thread. It is typically used during development but removed from the final application. Stack usage watermark is controlled with the define <code>OS_STACK_WATERMARK</code>.</p>
<p>Enabling this option significantly increases the execution time of <a class="el" href="group__CMSIS__RTOS__ThreadMgmt.html#ga8c59d9c5fcd0d286ad2a0f24dead8e6a">osThreadNew</a> (depends on thread stack size).</p>
<h1>Processor Mode for Thread Execution </h1>
<p>RTX5 allows to execute threads in unprivileged or privileged processor mode. The processor mode is controlled with the define <code>OS_PRIVILEGE_MODE</code>.</p>
<p>In unprivileged processor mode, the software:</p>
<ul>
<li>has limited access to the MSR and MRS instructions, and cannot use the CPS instruction.</li>
<li>cannot access the system timer, NVIC, or system control block.</li>
<li>might have restricted access to memory or peripherals. In privileged processor mode the software can use all the instructions and has access to all resources.</li>
</ul>
<p><b>Thread Configuration Options</b></p>
<div class="image">
<img src="config_wizard_threads.png" alt="config_wizard_threads.png"/>
<div class="caption">
RTX_Config.c: Thread Configuration</div></div>
<p> <br/>
 </p>
<table class="doxtable">
<tr>
<th align="left">Option </th><th align="left">#define </th><th align="left">Description  </th></tr>
<tr>
<td align="left">Object specific Memory allocation </td><td align="left"><code>OS_THREAD_OBJ_MEM</code> </td><td align="left">Enables object specific memory allocation. See <a class="el" href="MemoryAllocation.html#ObjectMemoryPool">Object-specific Memory Pools</a>. </td></tr>
<tr>
<td align="left">Number of user Threads (total) </td><td align="left"><code>OS_THREAD_NUM</code> </td><td align="left">Defines maximum number of user threads that can be active at the same time. Applies to user threads with system provided memory for control blocks. Default value is <span class="XML-Token">1</span>. Value range is <span class="XML-Token">[1-1000]</span>. </td></tr>
<tr>
<td align="left">Number of user Threads with user-provided Stack size </td><td align="left"><code>OS_THREAD_USER_STACK_NUM</code> </td><td align="left">Defines maximum number of user threads with user-provided stack size. Default value is <span class="XML-Token">0</span>. Value range is <span class="XML-Token">[0-1000]</span>. </td></tr>
<tr>
<td align="left">Total Stack size [bytes] for user Threads with user-provided Stack size </td><td align="left"><code>OS_THREAD_USER_STACK_SIZE</code> </td><td align="left">Defines the combined stack size for user threads with user-provided stack size. Default value is <span class="XML-Token">0</span>. Value range is <span class="XML-Token">[0-1073741824]</span> Bytes, in multiples of <span class="XML-Token">8</span>. </td></tr>
<tr>
<td align="left">Default Thread Stack size [bytes] </td><td align="left"><code>OS_STACK_SIZE</code> </td><td align="left">Defines stack size for threads with zero stack size specified. Default value is <span class="XML-Token">200</span>. Value range is <span class="XML-Token">[96-1073741824]</span> Bytes, in multiples of <span class="XML-Token">8</span>. </td></tr>
<tr>
<td align="left">Idle Thread Stack size [bytes] </td><td align="left"><code>OS_IDLE_THREAD_STACK_SIZE</code> </td><td align="left">Defines stack size for Idle thread. Default value is <span class="XML-Token">200</span>. Value range is <span class="XML-Token">[72-1073741824]</span> bytes, in multiples of <span class="XML-Token">8</span>. </td></tr>
<tr>
<td align="left">Stack overrun checking </td><td align="left"><code>OS_STACK_CHECK</code> </td><td align="left">Enable stack overrun checks at thread switch. </td></tr>
<tr>
<td align="left">Stack usage watermark </td><td align="left"><code>OS_STACK_WATERMARK</code> </td><td align="left">Initialize thread stack with watermark pattern for analyzing stack usage. Enabling this option increases significantly the execution time of thread creation. </td></tr>
<tr>
<td align="left">Processor mode for Thread execution </td><td align="left"><code>OS_PRIVILEGE_MODE</code> </td><td align="left">Controls the processor mode. Default value is <span class="XML-Token">Privileged</span> mode. Value range is <span class="XML-Token">[0=Unprivileged; 1=Privileged]</span> mode. </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">index</a></li><li class="navelem"><a class="el" href="config_rtx.html">Configure RTX v5</a></li>
    <li class="footer">Generated on Fri Nov 11 2016 12:41:45 for CMSIS-RTOS2 by ARM Ltd. All rights reserved.
	<!--
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 
	-->
	</li>
  </ul>
</div>
</body>
</html>
